name: Janus-Gateway-Security-CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  security-audit:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Validate Protocol Integrity (Layer 9)
        run: |
          echo "Vérification de la présence du Protocole Lambda..."
          if [ ! -f protocols/PROTOCOL_LAMBDA_V1.1.md ]; then
            echo "ERREUR : Protocole Lambda manquant. Déploiement stoppé."
            exit 1
          fi

      - name: Check for Clandestine Modifications
        run: |
          echo "Analyse des modifications dans les dossiers critiques..."
          # Empêche la modification des logs sans mise à jour du protocole
          if git diff --name-only origin/main | grep -q "logs/"; then
            echo "Alerte : Modification des logs détectée. Revue humaine requise."
          fi

      - name: Automated Success Notification
        if: success()
        run: echo "Vérification réussie. L'Axe Hybride est stable."
